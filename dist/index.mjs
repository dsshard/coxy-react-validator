import {createContext,forwardRef,useContext,useRef,useEffect,useState,useCallback,useImperativeHandle,useMemo}from'react';import {jsx}from'react/jsx-runtime';var R=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,x={notEmpty:[{rule:r=>r!==""&&r.length>0,message:"Value is required"}],bool:[{rule:r=>!!r,message:"Value is required"}],password:[{rule:r=>r.length>0,message:"Password field cannot be empty"},{rule:r=>r.length>5,message:"Password field can not be less than 6 characters"}],email:[{rule:r=>!!r&&r!==""&&r.length!==0,message:"Email is required"},{rule:r=>R.test(String(r).toLowerCase()),message:"Email is invalid"}],min:r=>[{rule:e=>Number.parseFloat(e)>r,message:`The value must be greater than ${r}`}],max:r=>[{rule:e=>Number.parseFloat(e)<r,message:`The value must be smaller ${r}`}],length:(r,e)=>[{rule:t=>String(t).length>=r,message:`No less than ${r} symbols`},{rule:t=>e!==void 0?String(t).length<=e:true,message:`No more than ${e} symbols`}]};var V=class{rules;required;value;id;constructor({rules:e,required:t,value:a,id:i}){this.rules=e,this.required=t,this.value=a,this.id=i;}validate(){let e=true,t="",{rules:a,value:i,required:n,id:p}=this,u=!i&&Number.parseFloat(i)!==0;if(!a.length||u&&n===false)return {isValid:e,message:t,id:p};for(let s of a)e&&(e=s.rule(i),e||(typeof s.message=="function"?t=s.message(i):t=s.message));return {isValid:e,message:t,id:p}}},m=class{fields;params;constructor(e){this.params=e||null,this.fields=[];}addField(e){let t=new V(e);return this.fields.push(t),t}removeField(e){let t=this.fields.indexOf(e);t>-1&&this.fields.splice(t,1);}getField(e){return this.fields.find(t=>t.id===e)||null}validate(){let e,a=this.fields.map(i=>this.params?.stopAtFirstError&&e&&e.isValid===false?null:(e=i.validate(),e)).filter(i=>i&&i.isValid===false);if(a.length){let{isValid:i,message:n}=a[0];return {isValid:i,message:n,errors:a}}return {isValid:true,message:""}}};function E(r,e){let t=new m;t.addField({value:r,rules:e});let{isValid:a,...i}=t.validate();return [a,i]}var v=createContext(null);var w=forwardRef(function(e,t){let{children:a,value:i}=e,{customErrors:n,registerField:p,unregisterField:u}=useContext(v),s=useRef(e);s.current=e;let g=useRef(n);g.current=n;let o=useRef(null);o.current||(o.current={get props(){return s.current},validate:()=>{let c=s.current,y=g.current.find(d=>d.id===c.id);return y||new V({rules:c.rules,required:c.required,value:c.value,id:c.id}).validate()}}),useEffect(()=>(o.current&&p(o.current),()=>{o.current&&u(o.current);}),[p,u]);let F=o.current.validate();return typeof a=="function"?a(F,i):a});var S=forwardRef(function({children:e,stopAtFirstError:t},a){let i=useRef([]),[n,p]=useState([]),u=useCallback(l=>{l&&!i.current.includes(l)&&i.current.push(l);},[]),s=useCallback(l=>{let d=i.current.indexOf(l);d>-1&&i.current.splice(d,1);},[]),g=useCallback(l=>i.current.find(d=>d?.props?.id===l)||null,[]),o=useCallback(l=>{p(d=>[...d,l]);},[]),F=useCallback(()=>{p([]);},[]),c=useCallback(()=>{let l=new m({stopAtFirstError:t});for(let d of i.current)l.addField(d.props);return l.validate()},[t]);useImperativeHandle(a,()=>({validate:c,getField:g,registerField:u,unregisterField:s,setCustomError:o,clearCustomErrors:F}),[c,g,u,s,o,F]);let y=useMemo(()=>({customErrors:n,registerField:u,unregisterField:s}),[n,u,s]);return jsx(v.Provider,{value:y,children:e})});export{m as Validator,w as ValidatorField,S as ValidatorWrapper,x as rules,E as useValidator};//# sourceMappingURL=index.mjs.map
//# sourceMappingURL=index.mjs.map